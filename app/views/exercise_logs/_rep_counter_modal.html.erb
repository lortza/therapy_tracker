<!-- Modal -->
<div class="modal fade" id="repCounterModal" tabindex="-1" role="dialog" aria-labelledby="repCounterModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="repCounterModalLabel">Rep Counter</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Dismiss">
          <span class="modal-dismiss">Close</span>
        </button>
      </div>
      <div class="modal-body">
        <h3>
          <span id='begin-finished-indicator' class='hidden'></span>
        </h3>
        <div class='row'>
          <div class='col'>
            <p class='set-rep-row'>Set:<br>
              <span id='set' class='counter-number-big'>0</span> of <%= sets %>
            </p>
          </div>
          <div class='col'>
            <p class='set-rep-row'>Rep: (Hold for <%= rep_length %>)<br>
              <span id='rep' class='counter-number-big'>0</span> of <%= reps %><br>
            </p>
          </div>
        </div>

        <%= link_to '<i class="fas fa-play"></i> Start Timer'.html_safe, '#', id: 'start_button', class: button_class('success') %>
        <%= link_to '<i class="fas fa-stop"></i> Stop & Reset '.html_safe, cancel_url, id: 'stop_button', class: button_class('danger pull-right') %>

        <script>
          // Initialize counter when modal is shown (not when page loads)
          document.addEventListener('turbo:load', function() {
            const modal = document.getElementById('repCounterModal');
            if (modal && typeof window.counter === 'function') {
              // Remove any previous listener
              $(modal).off('shown.bs.modal');

              // Initialize counter when modal opens
              $(modal).on('shown.bs.modal', function () {
                counter(<%= sets %>, <%= reps %>, <%= rep_length %>);
              });
            }
          }, { once: true });
        </script>
      </div><!-- modal body -->
    </div>
  </div>
</div>
